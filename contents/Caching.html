<!DOCTYPE html>
<html lang="">
    <head>
        <title>Caching</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="bear-note-unique-identifier" content="A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B">
        <meta name="created" content="2022-11-13T13:23:50-0600">
        <meta name="modified" content="2024-08-09T11:06:36-0500">
        <meta name="tags" content="_book, _book/Programing, _book/Programing/Web-Scalability">
        <meta name="last device" content="xiaoquan’s MacBook Pro">
        
        <style>
             body {
   --base-background-color: #ffffff;
   --document-background-color: var(--base-background-color);
 }

.document-wrapper {
  /* Constants used to transform theme values to CSS */
  --transform-line-height-factor: 1.17;

  /* From template */
  --base-text-color: #444444;
  --base-text-secondary-color: #888888;
  --base-text-tertiary-color: #d9d9d9;
  --base-background-color: #ffffff;
  --base-background-secondary-color: #F3F5F7;
  --base-background-tertiary-color: #E4E5E6;
  --base-stroke-color: #d9d9d9;
  --base-stroke-secondary-color: #d9d9d9;
  --base-accent-color: #DD4C4F;
  --base-highlight-color: ;

  --document-background-color: var(--base-background-color);
  --document-text-color: var(--base-text-color);
  --document-text-secondary-color: var(--base-text-secondary-color);
  --document-text-light-color: var(--base-text-secondary-color);
  --document-accent-color: var(--base-accent-color);
  --document-cursor-color: var(--base-accent-color);
  --document-link-color: var(--base-accent-color);
  --document-list-marker-color: var(--base-accent-color);
  --document-marker-color: var(--base-text-tertiary-color);
  --document-selection-color: var(--base-selection-color);
  --document-selection-inactive-color: var(--base-background-tertiary-color);
  --document-text-font: "AvenirNext-Regular";
  --document-text-size: 15px;
  --document-line-height-multiplier: calc(
    1.5 * var(--transform-line-height-factor)
  );

  --document-headers-text-color: var(--base-text-color);
  --document-headers-font: "AvenirNext-Medium";
  --document-headers-modular-scale: 1.125;
  --document-headers-line-height-multiplier: calc(
    1.3 * var(--transform-line-height-factor)
  );
  --document-headers-add-top-bottom-padding: 1;
  --document-headers-padding-top-multiplier: 0.5;
  --document-headers-padding-bottom-multiplier: 0.3;

  --document-code-text-color: var(--base-text-color);
  --document-code-border-color: var(--base-text-tertiary-color);
  --document-code-background-color: var(--base-background-secondary-color);
  --document-code-font: "Menlo-Regular";
  --document-code-text-size-multiplier: 0.91em;

  --document-code-syntax-highlight-comment: #65798c;
  --document-code-syntax-highlight-constant: #0095c9;
  --document-code-syntax-highlight-number: #0095c9;
  --document-code-syntax-highlight-string: #d12f1b;
  --document-code-syntax-highlight-entity: #4a838b;
  --document-code-syntax-highlight-keyword: #ad3da4;
  --document-code-syntax-highlight-function: #4a838b;
  --document-code-syntax-highlight-variable: #4a838b;

  --document-task-background-color: var(--base-background-color);
  --document-task-border-color: var(--base-text-secondary-color);
  --document-task-check-color: var(--base-text-color);

  --document-tag-background-color: var(--base-background-tertiary-color);
  --document-tag-text-color: var(--base-text-color);
  --document-tag-marker-color: var(--base-text-secondary-color);

  --document-highlighter-background-color: #CDF7BD;
  --document-highlighter-text-color: #102D05;

  --document-highlighter-red-background-color: #FED09F;
  --document-highlighter-red-text-color: #321A00;

  --document-highlighter-blue-background-color: #C9E5FF;
  --document-highlighter-blue-text-color: #001A32;

  --document-highlighter-green-background-color: #CDF7BD;
  --document-highlighter-green-text-color: #102D05;

  --document-highlighter-purple-background-color: #FEDAFF;
  --document-highlighter-purple-text-color: #310032;

  --document-highlighter-yellow-background-color: #FCF195;
  --document-highlighter-yellow-text-color: #312C01;
  
  --document-file-fold-color: var(--base-background-tertiary-color);
  --document-file-background-color: var(--base-background-secondary-color);

  --document-separator-border-color: var(--base-stroke-secondary-color);

  --document-table-border-color: var(--base-stroke-secondary-color);
  --document-table-cell-background-color: var(--base-background-color);
  --document-table-cell-alternate-background-color: var(
    --base-background-secondary-color
  );
}

.document-wrapper,body{background-color:var(--document-background-color)}.document-wrapper h1.setext,.document-wrapper h2.setext{border-bottom:calc(2 * var(--document-hairline-width)) solid var(--document-separator-border-color);padding-bottom:.6em}.document-wrapper blockquote blockquote blockquote blockquote blockquote::before,.document-wrapper blockquote blockquote blockquote::before,.document-wrapper blockquote::before{background-color:var(--document-list-marker-color)}.document-wrapper td[data-alignment="1"],.document-wrapper th{text-align:left}.document-wrapper :after,.document-wrapper :before,.document-wrapper a,.document-wrapper abbr,.document-wrapper acronym,.document-wrapper address,.document-wrapper applet,.document-wrapper article,.document-wrapper aside,.document-wrapper audio,.document-wrapper b,.document-wrapper big,.document-wrapper blockquote,.document-wrapper canvas,.document-wrapper caption,.document-wrapper center,.document-wrapper cite,.document-wrapper code,.document-wrapper dd,.document-wrapper del,.document-wrapper details,.document-wrapper dfn,.document-wrapper div,.document-wrapper dl,.document-wrapper dt,.document-wrapper em,.document-wrapper embed,.document-wrapper fieldset,.document-wrapper figcaption,.document-wrapper figure,.document-wrapper footer,.document-wrapper form,.document-wrapper h1,.document-wrapper h2,.document-wrapper h3,.document-wrapper h4,.document-wrapper h5,.document-wrapper h6,.document-wrapper header,.document-wrapper hgroup,.document-wrapper i,.document-wrapper iframe,.document-wrapper ins,.document-wrapper kbd,.document-wrapper label,.document-wrapper legend,.document-wrapper li,.document-wrapper mark,.document-wrapper menu,.document-wrapper nav,.document-wrapper object,.document-wrapper ol,.document-wrapper output,.document-wrapper p,.document-wrapper pre,.document-wrapper q,.document-wrapper ruby,.document-wrapper s,.document-wrapper samp,.document-wrapper section,.document-wrapper small,.document-wrapper span,.document-wrapper strike,.document-wrapper strong,.document-wrapper summary,.document-wrapper table,.document-wrapper tbody,.document-wrapper td,.document-wrapper tfoot,.document-wrapper th,.document-wrapper thead,.document-wrapper time,.document-wrapper tr,.document-wrapper tt,.document-wrapper u,.document-wrapper ul,.document-wrapper var,.document-wrapper video{all:unset}.document-wrapper{--document-inline-padding-top-bottom:0.25em;--document-inline-padding-left-right:0.25em;--header-1-font-size:2em;--header-2-font-size:1.6em;--header-3-font-size:1.27em;--document-hairline-width:calc(var(--document-text-size) / 15);box-sizing:border-box;color:var(--document-text-color);font-family:var(--document-text-font);font-size:var(--document-text-size);line-height:var(--document-line-height-multiplier);min-height:100%;max-width:48em;width:100%;tab-size:4;margin:0 auto;padding:0 2em}body{text-rendering:optimizeLegibility}.document-wrapper:focus-visible{outline:0}.document-wrapper .marker{color:var(--document-marker-color);display:none}.document-wrapper [data-direction="2"]{direction:rtl}.document-wrapper div.footnote,.document-wrapper div.link-definition,.document-wrapper p{display:block}.document-wrapper p.blank-line::before{content:" "}.document-wrapper h1,.document-wrapper h2,.document-wrapper h3,.document-wrapper h4,.document-wrapper h5,.document-wrapper h6{font-family:var(--document-headers-font);display:block;line-height:var(--document-headers-line-height-multiplier)}.document-wrapper h1{font-size:var(--header-1-font-size);padding-block-start:0.8em;padding-block-end:0.33em}.document-wrapper h2{font-size:var(--header-2-font-size);padding-block-start:0.66em;padding-block-end:0.27em}.document-wrapper h3{font-size:var(--header-3-font-size);padding-block-start:0.53em;padding-block-end:0.27em}.document-wrapper code,.document-wrapper pre{font-size:var(--document-code-text-size-multiplier);font-family:var(--document-code-font),monospace}.document-wrapper h4,.document-wrapper h5,.document-wrapper h6{padding-block-start:0.4em;padding-block-end:0.27em}.document-wrapper h1.setext{margin-bottom:.45em}.document-wrapper h2.setext{margin-bottom:.2em}.document-wrapper .fenced-code *,.document-wrapper .fenced-code-content .marker,.document-wrapper .fenced-code-content .space,.document-wrapper .hard-linebreak-marker,.document-wrapper .image .space,.document-wrapper .image-destination,.document-wrapper .image-label,.document-wrapper .image-title,.document-wrapper .indented-code .space,.document-wrapper .link .space,.document-wrapper .link-destination,.document-wrapper .link-label,.document-wrapper .link-title,.document-wrapper .replace .text,.document-wrapper .setext-heading-marker+.line-ending,.document-wrapper .yaml-marker+.line-ending,.document-wrapper li>p>.space:first-child,.document-wrapper tr.delimiter-row{display:none}.document-wrapper ol,.document-wrapper ul{display:block;padding-inline-start:2.13em}.document-wrapper li{display:list-item;color:var(--document-text-color)}.document-wrapper .color-marker,.document-wrapper .entity-marker,.document-wrapper .fenced-code-content,.document-wrapper .fenced-code-content *,.document-wrapper .footnote-separator,.document-wrapper .link-definition-separator,.document-wrapper code.code-inline,.document-wrapper li>p{display:inline}.document-wrapper ul{list-style-type:disc}.document-wrapper li li li li li li li ul,.document-wrapper li li li li li ul,.document-wrapper li li li ul,.document-wrapper li ul{list-style:circle}.document-wrapper li li li li li li ul,.document-wrapper li li li li ul,.document-wrapper li li ul{list-style:disc}.document-wrapper li::marker{color:var(--document-list-marker-color)}.document-wrapper ol{list-style-type:none;counter-reset:custom-list-item calc(var(--data-list-start,1) - 1)}.document-wrapper ol>li{counter-increment:custom-list-item;position:relative}.document-wrapper ol>li::before{content:counter(custom-list-item) ". ";color:var(--document-list-marker-color);position:absolute;transform:translate(calc(-100% - .33em),0)}.document-wrapper ol>li[data-big-number=true]{margin-inline-start:-2.05em}.document-wrapper ol>li[data-big-number=true]::before{position:static;padding-inline-end:0.25em}.document-wrapper ol>li[data-list-type="1"]:before{content:counter(custom-list-item) ") "}.document-wrapper [data-direction="2"] ol>li::before,.document-wrapper ol[data-direction="2"]>li::before{transform:translate(calc(100% + .33em),0)}.document-wrapper li[role=checkbox]{list-style:none;position:relative}.document-wrapper li[aria-checked=true]{color:var(--document-text-secondary-color)}.document-wrapper .todo-checkbox{display:inline-block;margin-left:-1.7em;margin-right:.5em}.document-wrapper .todo-checkbox svg{display:inline-block;margin-bottom:-.3em}.document-wrapper blockquote{display:block;padding-inline-start:2.13em;position:relative}.document-wrapper code,.document-wrapper mark,span.highlighted{padding:var(--document-inline-padding-top-bottom) var(--document-inline-padding-left-right)}.document-wrapper blockquote::before{content:"";position:absolute;top:.2em;left:1em;width:.13em;height:calc(100% - .4em);border:var(--document-hairline-width) solid var(--document-list-marker-color);border-radius:.33em}.document-wrapper code,.document-wrapper pre.fenced-code,.document-wrapper pre.indented-code,.document-wrapper pre.yaml{color:var(--document-code-text-color);background-color:var(--document-code-background-color);border-radius:.25em}.document-wrapper [data-direction="2"] blockquote::before,.document-wrapper blockquote[data-direction="2"]::before{left:0;right:1em}.document-wrapper blockquote blockquote blockquote blockquote blockquote blockquote::before,.document-wrapper blockquote blockquote blockquote blockquote::before,.document-wrapper blockquote blockquote::before{background-color:transparent}.document-wrapper hr{display:block;margin-block-start:calc(var(--document-line-height-multiplier) * 0.5em);margin-block-end:calc(var(--document-line-height-multiplier) * -0.5em);border-top:var(--document-hairline-width) solid var(--document-separator-border-color)}.document-wrapper pre{display:block;white-space:pre-wrap}.document-wrapper pre.indented-code{padding-inline-start:2.13em}.document-wrapper pre.fenced-code,.document-wrapper pre.yaml{padding:0 .5em}.document-wrapper .fenced-code::before{content:"\200B"}.document-wrapper code{font-weight:400;font-style:normal;display:block}.document-wrapper mark code{color:var(--document-text-color);background-color:var(--document-highlighter-background-color)}.document-wrapper em,.document-wrapper i{font-family:AvenirNext-Italic}.document-wrapper b,.document-wrapper strong,.document-wrapper th{font-family:AvenirNext-Bold}.document-wrapper mark,span.highlighted{color:var(--document-highlighter-background-text-color);background-color:var(--document-highlighter-background-color);text-decoration:inherit;unicode-bidi:embed;border-radius:.25em}.document-wrapper mark.red,span.highlighted.red{color:var(--document-highlighter-red-background-text-color);background-color:var(--document-highlighter-red-background-color)}.document-wrapper mark.blue,span.highlighted.blue{color:var(--document-highlighter-blue-background-text-color);background-color:var(--document-highlighter-blue-background-color)}.document-wrapper mark.green,span.highlighted.green{color:var(--document-highlighter-green-background-text-color);background-color:var(--document-highlighter-green-background-color)}.document-wrapper mark.yellow,span.highlighted.yellow{color:var(--document-highlighter-yellow-background-text-color);background-color:var(--document-highlighter-yellow-background-color)}.document-wrapper mark.purple,span.highlighted.purple{color:var(--document-highlighter-purple-background-text-color);background-color:var(--document-highlighter-purple-background-color)}.document-wrapper u{text-decoration:underline;text-decoration-color:var(--document-accent-color);unicode-bidi:embed}.document-wrapper s,.document-wrapper strike{text-decoration:line-through}.document-wrapper a{color:var(--document-link-color);unicode-bidi:embed;cursor:pointer}.document-wrapper a:hover{text-decoration:inherit}.document-wrapper .wiki-separator-marker{display:inline;color:inherit}.document-wrapper .link-definition-title{color:var(--document-text-light-color)}.document-wrapper .footnote-ref{font-size:.9em;vertical-align:super}.document-wrapper span.entity{direction:ltr;unicode-bidi:embed;color:var(--document-code-syntax-highlight-entity)}.document-wrapper span.escape{unicode-bidi:embed}.document-wrapper .color{font-family:var(--document-code-font),monospace;font-size:var(--document-code-text-size-multiplier);padding-inline-start:1.2em;position:relative;direction:ltr;unicode-bidi:embed}.document-wrapper .color::before{content:"";position:absolute;width:.9em;height:.9em;left:0;bottom:0;transform:translateY(-15%);border:var(--document-hairline-width) solid rgb(0,0,0,.3);border-radius:.9em;background-color:var(--data-color)}.document-wrapper .hashtag{color:var(--document-tag-text-color);background-color:var(--document-tag-background-color);border-radius:1em;padding:calc(var(--document-inline-padding-top-bottom) - 2 * var(--document-hairline-width)) calc(var(--document-inline-padding-left-right) + .3em);unicode-bidi:embed}.document-wrapper .hashtag>.marker{display:inline;color:var(--document-tag-marker-color);padding:0}.document-wrapper table{display:block;max-width:fit-content;overflow-x:auto;border-collapse:separate;border-spacing:0;border:var(--document-hairline-width) solid var(--document-table-border-color);border-radius:.33em;margin-bottom:calc(var(--document-line-height-multiplier) * 1em)}.document-wrapper table[data-direction="2"]{margin-left:auto;direction:ltr}.document-wrapper tr{display:table-row;background-color:var(--document-table-cell-background-color)}.document-wrapper tr.header-row,.document-wrapper tr:nth-child(odd){background-color:var(--document-table-cell-alternate-background-color)}.document-wrapper td,.document-wrapper th{box-sizing:border-box;display:table-cell;padding:.37em .75em;min-width:5em;border-right:var(--document-hairline-width) solid var(--document-table-border-color)}.document-wrapper td:last-of-type,.document-wrapper th:last-of-type{border:none}.document-wrapper table[data-direction="2"] td{margin-left:auto}.document-wrapper td[data-alignment="2"]{text-align:right}.document-wrapper td[data-alignment="3"]{text-align:center}.document-wrapper .code_comment{color:var(--document-code-syntax-highlight-comment)}.document-wrapper .code_constant{color:var(--document-code-syntax-highlight-constant)}.document-wrapper .code_number{color:var(--document-code-syntax-highlight-number)}.document-wrapper .code_string{color:var(--document-code-syntax-highlight-string)}.document-wrapper .code_entity{color:var(--document-code-syntax-highlight-entity)}.document-wrapper .code_keyword{color:var(--document-code-syntax-highlight-keyword)}.document-wrapper .code_function{color:var(--document-code-syntax-highlight-function)}.document-wrapper .code_variable{color:var(--document-code-syntax-highlight-variable)}.document-wrapper img{max-width:100%}.document-wrapper .pdf_preview{display:inline-block;width:100%;height:500px;background-color:#fff;overflow:hidden;padding:0;margin:0;position:relative;border-radius:4px}.document-wrapper .arrow svg #body,.document-wrapper .arrow svg #head{fill:var(--base-text-color)}.document-wrapper .todo-checkbox svg #body{stroke:var(--document-task-border-color)}.document-wrapper .todo-checkbox svg #check{fill:var(--document-task-check-color)}.document-wrapper .todo-checkbox.todo-checked svg #body{opacity:.35}.document-wrapper .todo-checkbox.todo-checked svg #check{opacity:.4}

        </style>
    </head>
    <body>
        <div class="document-wrapper">
            <h1 id='Caching'>Caching</h1><br>
<h1 id='Table of Contents'>Table of Contents</h1><ul>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Cache%20Hit%20Ratio'>Cache Hit Ratio</a>
<ul>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Three%20Factors'>Three Factors</a></li>
</ul>
</li>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Caching%20Based%20on%20HTTP'>Caching Based on HTTP</a>
<ul>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=HTTP%20Caching%20Headers%20'>HTTP Caching Headers </a></li>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Types%20of%20HTTP%20Cache%20Technologies%20'>Types of HTTP Cache Technologies </a></li>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Scaling%20HTTP%20Caches%20%28Only%20reverse%20proxy%20as%20others%20are%20out%20of%20your%20control%29'>Scaling HTTP Caches (Only reverse proxy as others are out of your control)</a></li>
</ul>
</li>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Caching%20Application%20Objects'>Caching Application Objects</a>
<ul>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Common%20Types%20of%20Object%20Caches%20'>Common Types of Object Caches </a></li>
</ul>
</li>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Caching%20Rules%20of%20Thumb'>Caching Rules of Thumb</a>
<ul>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Cache%20High%20Up%20the%20Call%20Stack%20'>Cache High Up the Call Stack </a></li>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Reuse%20Cache%20Among%20Users%20'>Reuse Cache Among Users </a></li>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Where%20to%20Start%20Caching%3F%20'>Where to Start Caching? </a></li>
<li><a href='bear://x-callback-url/open-note?id=A0DA0FF9-1FF7-4F83-B398-4A7AE5B7761B&header=Cache%20Invalidation%20Is%20Difficult%20'>Cache Invalidation Is Difficult </a></li>
</ul>
</li>
</ul><br>
<hr><br>
<ul>
<li><i>“The supreme art of war is to subdue the enemy without fighting.”</i>
<ul>
<li>– Sun Tzu</li>
</ul>
</li>
</ul><br>
<h2 id='Cache Hit Ratio'>Cache Hit Ratio</h2><ul>
<li><b>Cache effectiveness</b> depends on <b>how many times</b> you can <b>reuse</b> the same cached response</li>
</ul><br>
<h3 id='Three Factors'>Three Factors</h3><ul>
<li><b>Cache key space</b>, the number of all possible cache keys that your application could generate (all of the possible cache, the less the better <span class='arrow'><svg width="12px" height="12px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="Arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(0.000000, 0.500000)" fill="#444444">
            <rect id="body" x="0" y="4.5" width="10" height="2"></rect>
            <path d="M7,0 L11.7928932,4.79289322 C12.1834175,5.18341751 12.1834175,5.81658249 11.7928932,6.20710678 L7,11 L7,11 L6,10 L8.5,6 L8.5,5 L6,1 L7,0 Z" id="head"></path>
        </g>
    </g>
</svg></span> more percentage can be cached <span class='arrow'><svg width="12px" height="12px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="Arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(0.000000, 0.500000)" fill="#444444">
            <rect id="body" x="0" y="4.5" width="10" height="2"></rect>
            <path d="M7,0 L11.7928932,4.79289322 C12.1834175,5.18341751 12.1834175,5.81658249 11.7928932,6.20710678 L7,11 L7,11 L6,10 L8.5,6 L8.5,5 L6,1 L7,0 Z" id="head"></path>
        </g>
    </g>
</svg></span> more hits)</li>
<li>The number of <b>items</b> that you can <b>store</b> in your cache before running out of space</li>
<li><b>How long</b>, on average, each object can be <b>stored</b> in cache <b>before</b> <b>expiring</b> or being invalidated
<ul>
<li><b>Time to Live</b> (TTL), data is valid for this amount of time
<ul>
<li>15 minutes maybe ok for weather forecast, not in other dynamic situations</li>
</ul>
</li>
</ul>
</li>
</ul><br>
<h2 id='Caching Based on HTTP'>Caching Based on HTTP</h2><ul>
<li><b>Read-through cache</b> is a <b>caching component</b> that can return cached resources or fetch the data for the client, if the request cannot be satisfied from cache (Client doesn’t connect to the service directly)</li>
</ul><p><img src='Caching/C86E10A6-3992-48C8-A8BC-7E866F498293.png'></p><ul>
<li>It is common to see <b>multiple</b> HTTP read-through caches <b>chained</b> to one another in a single web request without the client ever being aware of it.</li>
</ul><p><img src='Caching/74A0EFD3-71DA-439A-8F59-5CF50447C4F0.png'></p><br>
<h3 id='HTTP Caching Headers'>HTTP Caching Headers</h3><ul>
<li>Some headers have <b>over-lapping functions</b> (Cache-control header max-age, Expires header), decide which headers you want to use and <b>sticking</b> to them</li>
</ul><br>
<h4 id='Cache-Control header'>Cache-Control header</h4><h5 id='private'>private</h5><ul>
<li>The <b>result</b> is <b>specific</b> to the user who requested it
<ul>
<li>Only <b>browsers</b> will be able to cache this response because intermediate caches would not have the knowledge of what identifies a user.</li>
</ul>
</li>
</ul><br>
<h5 id='public'>public</h5><ul>
<li>The <b>response</b> can be <b>shared</b> between users as long as it has <b>not expired</b></li>
</ul><br>
<h5 id='no-store'>no-store</h5><ul>
<li>The response should <b>not</b> be <b>stored</b> on <b>disks</b> by any of the intermediate caches. (sensitive user information)</li>
</ul><br>
<h5 id='no-cache'>no-cache</h5><ul>
<li>The response should <b>not</b> be <b>cached</b>. (Cache needs to ask the server whether the data is valid every time)</li>
</ul><br>
<h5 id='max-age'>max-age</h5><ul>
<li>How many seconds this response can be served from the cache before becoming stale (it <b>defines</b> the <b>TTL</b> of the response)</li>
<li>Less backward-compatible, tends to cause inconsistency (Don’t recommend using)</li>
</ul><br>
<h5 id='no-transform'>no-transform</h5><ul>
<li>The <b>response</b> should be <b>served</b> <b>without any modifications</b>
<ul>
<li>A content delivery network (<b>CDN</b>) provider <b>might transcode</b> images to reduce their size, lowering the quality or changing the compression algorithm.</li>
</ul>
</li>
</ul><br>
<h5 id='must-revalidate'>must-revalidate</h5><ul>
<li>Once the <b>response</b> becomes <b>stale</b>, it <b>cannot be returned</b> to clients without revalidation.
<ul>
<li>Although it may seem odd, <b>caches may return stale objects</b> under certain conditions
<ul>
<li>If the <b>client explicitly allows</b> it</li>
<li>If the <b>cache loses connection</b> to the origin server.</li>
</ul>
</li>
</ul>
</li>
</ul><br>
<hr><br>
<h4 id='Expires header'>Expires header</h4><ul>
<li>Specify <b>an absolute point in time</b> when the object becomes <b>stale</b>
<ul>
<li><b>Expires: Sat, 23 Jul 2015 13:14:28 GMT</b></li>
</ul>
</li>
</ul><br>
<hr><br>
<h4 id='Vary header'>Vary header</h4><ul>
<li>Tell caches that you may need to <b>generate multiple variations</b> of the response based on some HTTP request headers.
<ul>
<li><b>Vary: Accept-Encoding</b></li>
</ul>
</li>
</ul><br>
<hr><br>
<h4 id='Some other headers'>Some other headers</h4><ul>
<li>Age, Last-Modified, If-Modified-Since, and Etag</li>
</ul><br>
<h4 id='Examples'>Examples</h4><ul>
<li>Static files that can be cached for a really long time
<ul>
<li><b>Cache static files under unique URL</b>, users who have older versions of HTML can still access old URL files</li>
</ul>
</li>
</ul><p><img src='Caching/B33814EC-23D8-45DE-BF41-C84C30ACEA49.png'></p><ul>
<li>Never stored, cached, or reused for any users.</li>
</ul><p><img src='Caching/611ED48C-7938-4418-A721-4FCB9931E2BC.png'></p><ul>
<li>User-specific data
<ul>
<li>Cached for 10 minutes</li>
</ul>
</li>
</ul><p><img src='Caching/E4C867B0-B994-4A1E-8963-BE305B74D99E.png'></p><ul>
<li><b>HTML meta-tags</b> for cache control (<b>avoid</b> these meta-tags altogether, as they <b>do not work for intermediate caches</b> and they may be a source of <b>confusion</b>)</li>
</ul><p><img src='Caching/21E43439-4B08-48E9-89B3-86C8BD21BF73.png'></p><br>
<h3 id='Types of HTTP Cache Technologies'>Types of HTTP Cache Technologies</h3><br>
<h4 id='Browser Cache'>Browser Cache</h4><ul>
<li>Browsers have <b>built-in caching capabilities</b> to <b>reduce the number of requests</b> sent out.
<ul>
<li>Usually implemented using a <b>combination of memory and local files</b></li>
</ul>
</li>
</ul><br>
<h4 id='Caching Proxy'>Caching Proxy</h4><ul>
<li>A caching proxy is a <b>server</b>, usually installed in a local corporate network or by the Internet service provider (ISP).
<ul>
<li>It is a <b>read-through cache</b> used to <b>reduce the amount of traffic</b> generated by the users of the network by <b>reusing responses between users of the network</b></li>
<li>The larger the network, the larger the potential saving</li>
</ul>
</li>
</ul><p><img src='Caching/B7AC67F3-3430-44F5-9F20-84C217CD4BEB.png'></p><br>
<h4 id='Reverse Proxy'>Reverse Proxy</h4><ul>
<li>Place a reverse proxy in your own <b>data center</b> to reduce the load put on your own web servers
<ul>
<li>You can <b>override HTTP headers</b> and <b>better control</b> which requests are being cached and for how long</li>
</ul>
</li>
</ul><p><img src='Caching/9BE5D990-06E3-47F6-AF41-AB60A0C2CECF.png'></p><br>
<h4 id='Content Delivery Networks'>Content Delivery Networks</h4><ul>
<li>A <b>content delivery network (CDN)</b> is a distributed network of cache servers that work in a similar way as caching proxies.</li>
<li>Web applications would typically use CDN to cache their <b>static files</b> like images, CSS, JavaScript, videos, or Portable Document File (PDF) documents.
<ul>
<li>Creating a <b>“static” subdomain</b> (for example, <a href='s.example.org'>s.example.org</a>)</li>
<li><b>Generating URLs</b> for all of your static files using this domain</li>
<li><b>Configure</b> the CDN provider to accept these requests on your behalf and point DNS for <a href='s.example.org'>s.example.org</a> to the CDN provider.</li>
<li>Any time CDN fails to serve a piece of content from its cache, it forwards the request to your web servers (<i>origin servers</i>) and caches the response for subsequent users.</li>
</ul>
</li>
<li>You can also configure some CDN providers to serve both <b>static and dynamic</b> content
<ul>
<li><b>Mitigate</b> distributed denial of service attacks (<b>DDoS</b>) (as CloudFlare does)</li>
<li>Further reduction of web requests sent to your origin servers</li>
</ul>
</li>
</ul><br>
<h3 id='Scaling HTTP Caches (Only reverse proxy as others are out of your control)'>Scaling HTTP Caches (Only reverse proxy as others are out of your control)</h3><ul>
<li><b>Hardware</b> or <b>open source software</b> (Nginx, Varnish, Squid, Apache mod_proxy, and Apache Traffic Server)
<ul>
<li>Should be <b>enough</b> for your startup, handle <b>more than 10,000</b> requests per second from a single machine</li>
<li><b>Focus on cache hit ratio</b> instead of scale reverse proxies</li>
</ul>
</li>
</ul><br>
<h4 id='The same three factors'>The same three factors</h4><ul>
<li><b>Cache key space</b>, Describes how many distinct URLs your reverse proxies will observe in a period of time (let’s say in an hour)
<ul>
<li>The more distinct URLs are served, the more memory or storage you need on each reverse proxy to be able to serve a significant portion of traffic from cache.</li>
</ul>
</li>
<li><b>Average response TTL</b>, Describes how long each response can be cached.
<ul>
<li>The longer you cache objects, the more chance you have to reuse them.</li>
<li>Do not have to worry much about cache servers becoming full by setting a long TTL, as <b>in-memory caches</b> use algorithms designed to <b>evict rarely accessed objects</b> and <b>reclaim space</b>
<ul>
<li>The most commonly used algorithm is <b>Least Recently Used (LRU)</b></li>
</ul>
</li>
</ul>
</li>
<li><b>Average size of cached object</b>, Affects how much memory or storage your reverse proxies will need to be able to store the most commonly accessed objects.
<ul>
<li><b>“Shrink” the objects</b>
<ul>
<li>CSS files and JavaScript files can be minified</li>
<li>HTML can be preprocessed to remove redundant white spaces and comments during the template-rendering phase</li>
</ul>
</li>
</ul>
</li>
</ul><br>
<h4 id='Reaching concurrency limit or throughput limit'>Reaching concurrency limit or throughput limit</h4><ul>
<li>Deploying <b>multiple reverse proxies</b> in parallel and distributing traffic among them</li>
</ul><p><img src='Caching/99EF646D-1C83-47A3-A650-92F9F8F1F83B.png'></p><br>
<h2 id='Caching Application Objects'>Caching Application Objects</h2><ul>
<li>They are <b>cache-aside</b> rather than read-through caches
<ul>
<li>The application needs to be aware of the existence of the object cache, and it actively uses it to store and retrieve objects rather than the cache being transparently positioned between the application and its data sources</li>
</ul>
</li>
</ul><br>
<h3 id='Common Types of Object Caches'>Common Types of Object Caches</h3><br>
<h4 id='Client-Side Caches'>Client-Side Caches</h4><ul>
<li>Store application data directly on the user’s device</li>
</ul><p><img src='Caching/D28B6F61-FE46-45D5-8DDD-F0B2B05D26FB.png'><br>
<img src='Caching/4F07D36D-00BC-4591-A90B-64DF2FF10698.png'></p><ul>
<li>It is isolated from your data center, which makes it impossible for your servers to remove/invalidate cached objects directly
<ul>
<li>Anytime you use web storage or similar client-side storage, you need to include the code responsible for cache refresh and invalidation in your front-end JavaScript code</li>
</ul>
</li>
</ul><br>
<h4 id='Caches Co-located with Code'>Caches Co-located with Code</h4><ul>
<li>located directly on your web servers</li>
<li>Local cache is usually implemented in one of the following ways:
<ul>
<li>Objects are cached directly in the application’s <b>memory</b></li>
<li>Objects are stored in <b>shared memory segments</b> so that multiple processes running on the same machine could access them</li>
<li>A caching server is deployed on each web server as a <b>separate application</b>
<ul>
<li>The application can also talk to an external caching server</li>
</ul>
</li>
</ul>
</li>
<li><b>Challenge</b> (Why it is <b>not recommended</b>)
<ul>
<li>Since cache is <b>not synced</b> across servers and request can come to all servers, many memory is wasted to cache the same data</li>
<li>It is not clear where the cache lives to <b>invalidate</b> data, because it may live in many servers</li>
</ul>
</li>
</ul><p><img src='Caching/86278F50-C90A-4B84-ABC3-C7C737EA83E4.png'></p><br>
<h4 id='Distributed Object Caches (Redis, Memcached)'>Distributed Object Caches (Redis, Memcached)</h4><ul>
<li>The main difference between this type and local server cache is that interacting with a distributed object cache usually requires a network <b>round trip to the cache server</b></li>
<li>Most caching servers have client libraries for all common programming language</li>
</ul><p><img src='Caching/D79A55FC-A506-4082-89DA-510BF4310A94.png'></p><ul>
<li><b>Efficiently remove</b> objects from the cache, allowing for cache invalidation on source data changes (connect to your cache and request object removal)</li>
<li><b>Deployment</b></li>
</ul><p><img src='Caching/1E7783F8-B87D-409A-9DF7-3465AE665AF0.png'></p><ul>
<li><b>Challenge</b>
<ul>
<li>Adding distributed cache, adds a certain amount of <b>complexity</b> and <b>management</b> overhead</li>
<li><b>Redis</b> is a very efficient cache server, and <b>a single machine</b> can support tens of thousands of operations per second, allowing you to grow to reasonable traffic without the need to scale it at all.
<ul>
<li>As long as throughput is not a problem, <b>scale vertically first</b> by adding more memory</li>
</ul>
</li>
</ul>
</li>
</ul><br>
<h5 id='Scaling Distributed Object Caches'>Scaling Distributed Object Caches</h5><ul>
<li><b>Data partition</b>
<ul>
<li>Memcached with libMemcached client library</li>
</ul>
</li>
</ul><p><img src='Caching/555243B2-8BC7-4785-9CD4-CE1C1DC3D79D.png'><br>
<img src='Caching/21CD1E99-21E5-45B9-80C8-11AA9BB748BF.png'></p><ul>
<li>By declaring a Memcached cluster, your data will be automatically distributed among the cache servers using a <b>consistent hashing</b> algorithm
<ul>
<li>Server sits in a hash ring with equal distance because the size of cache is pre-determined</li>
</ul>
</li>
</ul><p><img src='Caching/D41CAEFA-5388-43E3-A583-6A06C3E19CC2.png'></p><ul>
<li>Adding a server</li>
</ul><p><img src='Caching/4F118E50-DC49-4465-A4FF-E6D7FB900A1C.png'></p><ul>
<li>With replication</li>
</ul><p><img src='Caching/B6D5FAA9-4A65-4F19-9DAE-EF46BD5F44E1.png'></p><ul>
<li><b>Hosting</b>
<ul>
<li><b>Amazon</b>, you could either deploy your own caching servers on EC2 instances or use Amazon Elastic Cache
<ul>
<li>You will still need to distribute the load across the cache servers in your client code because Elastic Cache does not add transparent partitioning or automatic scalability</li>
</ul>
</li>
<li><b>Azure</b> lets you deploy a managed Redis instance with replication and automatic failover in a matter of a few clicks</li>
</ul>
</li>
</ul><br>
<h2 id='Caching Rules of Thumb'>Caching Rules of Thumb</h2><h3 id='Cache High Up the Call Stack'>Cache High Up the Call Stack</h3><p><img src='Caching/3B34D5DA-71D3-4783-9CE7-99585DD98CC7.png'></p><br>
<h3 id='Reuse Cache Among Users'>Reuse Cache Among Users</h3><ul>
<li>Think about how you could make you cache <b>more usable</b> for other users</li>
<li>The <b>second</b> one is <b>better</b>, as rounding does not influence restaurants in the area by much (as long as the rounding is correct) and able to cache the result for more requests</li>
</ul><p><img src='Caching/8988948E-7823-433B-B8CF-4D149B308980.png'><br>
<img src='Caching/CAF91B72-D301-4E18-9729-A5CA47199DC7.png'></p><br>
<h3 id='Where to Start Caching?'>Where to Start Caching?</h3><ul>
<li><b>Prioritize</b> based on a strict and simple metric</li>
<li><b>Aggregated time spent</b> = time spent per request * number of requests
<ul>
<li>which pages (or resources) are the most <b>valuable</b> when it comes to caching</li>
</ul>
</li>
<li>Google Analytics report and correlated traffic stats for the top 20 pages with the average time needed to render each of these pages.</li>
</ul><p><img src='Caching/8068B70A-FAC7-4E34-85FC-26D3185F24B0.png'></p><br>
<h3 id='Cache Invalidation Is Difficult'>Cache Invalidation Is Difficult</h3><ul>
<li>Cache invalidation is <b>difficult</b> because cached objects are usually a result of computation that takes multiple data sources as its <b>input</b>.
<ul>
<li>That, in turn, means that whenever any of these data sources changes, you should <b>invalidate all of the cached objects that have used it as input.</b></li>
</ul>
</li>
<li>To make it even more difficult, each piece of content may have <b>multiple representations,</b> in which case all of them would have to be removed from cache</li>
<li>The best <b>alternative</b> to cache invalidation is to <b>set a short TTL</b> on your cached objects so that data will not be stale for too long
<ul>
<li><b>Not always sufficient</b></li>
<li>Although <b>cache invalidation algorithms</b> are interesting to learn, I do not recommend implementing them unless absolutely necessary. I <b>recommend avoiding cache invalidation</b> altogether</li>
<li>In most cases, <b>short TTL or a hybrid solution</b>, where you load critical data on the fly, is enough to satisfy the business needs.</li>
</ul>
</li>
</ul><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<p><span class='hashtag'><span class='hashtag-marker marker'>#</span>_book<span class='hashtag-separator-marker marker'>/</span>Programing<span class='hashtag-separator-marker marker'>/</span>Web-Scalability</span></p>
        </div>
    </body>
</html>
