<!DOCTYPE html>
<html lang="">
    <head>
        <title>Asynchronous Processing</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="bear-note-unique-identifier" content="E7297FB5-2E32-4F51-A8BC-7FAF90C933A7">
        <meta name="created" content="2022-11-14T15:17:06-0600">
        <meta name="modified" content="2024-08-09T11:04:53-0500">
        <meta name="tags" content="_book, _book/Programing, _book/Programing/Web-Scalability">
        <meta name="last device" content="xiaoquan’s MacBook Pro">
        
        <style>
             body {
   --base-background-color: #ffffff;
   --document-background-color: var(--base-background-color);
 }

.document-wrapper {
  /* Constants used to transform theme values to CSS */
  --transform-line-height-factor: 1.17;

  /* From template */
  --base-text-color: #444444;
  --base-text-secondary-color: #888888;
  --base-text-tertiary-color: #d9d9d9;
  --base-background-color: #ffffff;
  --base-background-secondary-color: #F3F5F7;
  --base-background-tertiary-color: #E4E5E6;
  --base-stroke-color: #d9d9d9;
  --base-stroke-secondary-color: #d9d9d9;
  --base-accent-color: #DD4C4F;
  --base-highlight-color: ;

  --document-background-color: var(--base-background-color);
  --document-text-color: var(--base-text-color);
  --document-text-secondary-color: var(--base-text-secondary-color);
  --document-text-light-color: var(--base-text-secondary-color);
  --document-accent-color: var(--base-accent-color);
  --document-cursor-color: var(--base-accent-color);
  --document-link-color: var(--base-accent-color);
  --document-list-marker-color: var(--base-accent-color);
  --document-marker-color: var(--base-text-tertiary-color);
  --document-selection-color: var(--base-selection-color);
  --document-selection-inactive-color: var(--base-background-tertiary-color);
  --document-text-font: "AvenirNext-Regular";
  --document-text-size: 15px;
  --document-line-height-multiplier: calc(
    1.5 * var(--transform-line-height-factor)
  );

  --document-headers-text-color: var(--base-text-color);
  --document-headers-font: "AvenirNext-Medium";
  --document-headers-modular-scale: 1.125;
  --document-headers-line-height-multiplier: calc(
    1.3 * var(--transform-line-height-factor)
  );
  --document-headers-add-top-bottom-padding: 1;
  --document-headers-padding-top-multiplier: 0.5;
  --document-headers-padding-bottom-multiplier: 0.3;

  --document-code-text-color: var(--base-text-color);
  --document-code-border-color: var(--base-text-tertiary-color);
  --document-code-background-color: var(--base-background-secondary-color);
  --document-code-font: "Menlo-Regular";
  --document-code-text-size-multiplier: 0.91em;

  --document-code-syntax-highlight-comment: #65798c;
  --document-code-syntax-highlight-constant: #0095c9;
  --document-code-syntax-highlight-number: #0095c9;
  --document-code-syntax-highlight-string: #d12f1b;
  --document-code-syntax-highlight-entity: #4a838b;
  --document-code-syntax-highlight-keyword: #ad3da4;
  --document-code-syntax-highlight-function: #4a838b;
  --document-code-syntax-highlight-variable: #4a838b;

  --document-task-background-color: var(--base-background-color);
  --document-task-border-color: var(--base-text-secondary-color);
  --document-task-check-color: var(--base-text-color);

  --document-tag-background-color: var(--base-background-tertiary-color);
  --document-tag-text-color: var(--base-text-color);
  --document-tag-marker-color: var(--base-text-secondary-color);

  --document-highlighter-background-color: #CDF7BD;
  --document-highlighter-text-color: #102D05;

  --document-highlighter-red-background-color: #FED09F;
  --document-highlighter-red-text-color: #321A00;

  --document-highlighter-blue-background-color: #C9E5FF;
  --document-highlighter-blue-text-color: #001A32;

  --document-highlighter-green-background-color: #CDF7BD;
  --document-highlighter-green-text-color: #102D05;

  --document-highlighter-purple-background-color: #FEDAFF;
  --document-highlighter-purple-text-color: #310032;

  --document-highlighter-yellow-background-color: #FCF195;
  --document-highlighter-yellow-text-color: #312C01;
  
  --document-file-fold-color: var(--base-background-tertiary-color);
  --document-file-background-color: var(--base-background-secondary-color);

  --document-separator-border-color: var(--base-stroke-secondary-color);

  --document-table-border-color: var(--base-stroke-secondary-color);
  --document-table-cell-background-color: var(--base-background-color);
  --document-table-cell-alternate-background-color: var(
    --base-background-secondary-color
  );
}

.document-wrapper,body{background-color:var(--document-background-color)}.document-wrapper h1.setext,.document-wrapper h2.setext{border-bottom:calc(2 * var(--document-hairline-width)) solid var(--document-separator-border-color);padding-bottom:.6em}.document-wrapper blockquote blockquote blockquote blockquote blockquote::before,.document-wrapper blockquote blockquote blockquote::before,.document-wrapper blockquote::before{background-color:var(--document-list-marker-color)}.document-wrapper td[data-alignment="1"],.document-wrapper th{text-align:left}.document-wrapper :after,.document-wrapper :before,.document-wrapper a,.document-wrapper abbr,.document-wrapper acronym,.document-wrapper address,.document-wrapper applet,.document-wrapper article,.document-wrapper aside,.document-wrapper audio,.document-wrapper b,.document-wrapper big,.document-wrapper blockquote,.document-wrapper canvas,.document-wrapper caption,.document-wrapper center,.document-wrapper cite,.document-wrapper code,.document-wrapper dd,.document-wrapper del,.document-wrapper details,.document-wrapper dfn,.document-wrapper div,.document-wrapper dl,.document-wrapper dt,.document-wrapper em,.document-wrapper embed,.document-wrapper fieldset,.document-wrapper figcaption,.document-wrapper figure,.document-wrapper footer,.document-wrapper form,.document-wrapper h1,.document-wrapper h2,.document-wrapper h3,.document-wrapper h4,.document-wrapper h5,.document-wrapper h6,.document-wrapper header,.document-wrapper hgroup,.document-wrapper i,.document-wrapper iframe,.document-wrapper ins,.document-wrapper kbd,.document-wrapper label,.document-wrapper legend,.document-wrapper li,.document-wrapper mark,.document-wrapper menu,.document-wrapper nav,.document-wrapper object,.document-wrapper ol,.document-wrapper output,.document-wrapper p,.document-wrapper pre,.document-wrapper q,.document-wrapper ruby,.document-wrapper s,.document-wrapper samp,.document-wrapper section,.document-wrapper small,.document-wrapper span,.document-wrapper strike,.document-wrapper strong,.document-wrapper summary,.document-wrapper table,.document-wrapper tbody,.document-wrapper td,.document-wrapper tfoot,.document-wrapper th,.document-wrapper thead,.document-wrapper time,.document-wrapper tr,.document-wrapper tt,.document-wrapper u,.document-wrapper ul,.document-wrapper var,.document-wrapper video{all:unset}.document-wrapper{--document-inline-padding-top-bottom:0.25em;--document-inline-padding-left-right:0.25em;--header-1-font-size:2em;--header-2-font-size:1.6em;--header-3-font-size:1.27em;--document-hairline-width:calc(var(--document-text-size) / 15);box-sizing:border-box;color:var(--document-text-color);font-family:var(--document-text-font);font-size:var(--document-text-size);line-height:var(--document-line-height-multiplier);min-height:100%;max-width:48em;width:100%;tab-size:4;margin:0 auto;padding:0 2em}body{text-rendering:optimizeLegibility}.document-wrapper:focus-visible{outline:0}.document-wrapper .marker{color:var(--document-marker-color);display:none}.document-wrapper [data-direction="2"]{direction:rtl}.document-wrapper div.footnote,.document-wrapper div.link-definition,.document-wrapper p{display:block}.document-wrapper p.blank-line::before{content:" "}.document-wrapper h1,.document-wrapper h2,.document-wrapper h3,.document-wrapper h4,.document-wrapper h5,.document-wrapper h6{font-family:var(--document-headers-font);display:block;line-height:var(--document-headers-line-height-multiplier)}.document-wrapper h1{font-size:var(--header-1-font-size);padding-block-start:0.8em;padding-block-end:0.33em}.document-wrapper h2{font-size:var(--header-2-font-size);padding-block-start:0.66em;padding-block-end:0.27em}.document-wrapper h3{font-size:var(--header-3-font-size);padding-block-start:0.53em;padding-block-end:0.27em}.document-wrapper code,.document-wrapper pre{font-size:var(--document-code-text-size-multiplier);font-family:var(--document-code-font),monospace}.document-wrapper h4,.document-wrapper h5,.document-wrapper h6{padding-block-start:0.4em;padding-block-end:0.27em}.document-wrapper h1.setext{margin-bottom:.45em}.document-wrapper h2.setext{margin-bottom:.2em}.document-wrapper .fenced-code *,.document-wrapper .fenced-code-content .marker,.document-wrapper .fenced-code-content .space,.document-wrapper .hard-linebreak-marker,.document-wrapper .image .space,.document-wrapper .image-destination,.document-wrapper .image-label,.document-wrapper .image-title,.document-wrapper .indented-code .space,.document-wrapper .link .space,.document-wrapper .link-destination,.document-wrapper .link-label,.document-wrapper .link-title,.document-wrapper .replace .text,.document-wrapper .setext-heading-marker+.line-ending,.document-wrapper .yaml-marker+.line-ending,.document-wrapper li>p>.space:first-child,.document-wrapper tr.delimiter-row{display:none}.document-wrapper ol,.document-wrapper ul{display:block;padding-inline-start:2.13em}.document-wrapper li{display:list-item;color:var(--document-text-color)}.document-wrapper .color-marker,.document-wrapper .entity-marker,.document-wrapper .fenced-code-content,.document-wrapper .fenced-code-content *,.document-wrapper .footnote-separator,.document-wrapper .link-definition-separator,.document-wrapper code.code-inline,.document-wrapper li>p{display:inline}.document-wrapper ul{list-style-type:disc}.document-wrapper li li li li li li li ul,.document-wrapper li li li li li ul,.document-wrapper li li li ul,.document-wrapper li ul{list-style:circle}.document-wrapper li li li li li li ul,.document-wrapper li li li li ul,.document-wrapper li li ul{list-style:disc}.document-wrapper li::marker{color:var(--document-list-marker-color)}.document-wrapper ol{list-style-type:none;counter-reset:custom-list-item calc(var(--data-list-start,1) - 1)}.document-wrapper ol>li{counter-increment:custom-list-item;position:relative}.document-wrapper ol>li::before{content:counter(custom-list-item) ". ";color:var(--document-list-marker-color);position:absolute;transform:translate(calc(-100% - .33em),0)}.document-wrapper ol>li[data-big-number=true]{margin-inline-start:-2.05em}.document-wrapper ol>li[data-big-number=true]::before{position:static;padding-inline-end:0.25em}.document-wrapper ol>li[data-list-type="1"]:before{content:counter(custom-list-item) ") "}.document-wrapper [data-direction="2"] ol>li::before,.document-wrapper ol[data-direction="2"]>li::before{transform:translate(calc(100% + .33em),0)}.document-wrapper li[role=checkbox]{list-style:none;position:relative}.document-wrapper li[aria-checked=true]{color:var(--document-text-secondary-color)}.document-wrapper .todo-checkbox{display:inline-block;margin-left:-1.7em;margin-right:.5em}.document-wrapper .todo-checkbox svg{display:inline-block;margin-bottom:-.3em}.document-wrapper blockquote{display:block;padding-inline-start:2.13em;position:relative}.document-wrapper code,.document-wrapper mark,span.highlighted{padding:var(--document-inline-padding-top-bottom) var(--document-inline-padding-left-right)}.document-wrapper blockquote::before{content:"";position:absolute;top:.2em;left:1em;width:.13em;height:calc(100% - .4em);border:var(--document-hairline-width) solid var(--document-list-marker-color);border-radius:.33em}.document-wrapper code,.document-wrapper pre.fenced-code,.document-wrapper pre.indented-code,.document-wrapper pre.yaml{color:var(--document-code-text-color);background-color:var(--document-code-background-color);border-radius:.25em}.document-wrapper [data-direction="2"] blockquote::before,.document-wrapper blockquote[data-direction="2"]::before{left:0;right:1em}.document-wrapper blockquote blockquote blockquote blockquote blockquote blockquote::before,.document-wrapper blockquote blockquote blockquote blockquote::before,.document-wrapper blockquote blockquote::before{background-color:transparent}.document-wrapper hr{display:block;margin-block-start:calc(var(--document-line-height-multiplier) * 0.5em);margin-block-end:calc(var(--document-line-height-multiplier) * -0.5em);border-top:var(--document-hairline-width) solid var(--document-separator-border-color)}.document-wrapper pre{display:block;white-space:pre-wrap}.document-wrapper pre.indented-code{padding-inline-start:2.13em}.document-wrapper pre.fenced-code,.document-wrapper pre.yaml{padding:0 .5em}.document-wrapper .fenced-code::before{content:"\200B"}.document-wrapper code{font-weight:400;font-style:normal;display:block}.document-wrapper mark code{color:var(--document-text-color);background-color:var(--document-highlighter-background-color)}.document-wrapper em,.document-wrapper i{font-family:AvenirNext-Italic}.document-wrapper b,.document-wrapper strong,.document-wrapper th{font-family:AvenirNext-Bold}.document-wrapper mark,span.highlighted{color:var(--document-highlighter-background-text-color);background-color:var(--document-highlighter-background-color);text-decoration:inherit;unicode-bidi:embed;border-radius:.25em}.document-wrapper mark.red,span.highlighted.red{color:var(--document-highlighter-red-background-text-color);background-color:var(--document-highlighter-red-background-color)}.document-wrapper mark.blue,span.highlighted.blue{color:var(--document-highlighter-blue-background-text-color);background-color:var(--document-highlighter-blue-background-color)}.document-wrapper mark.green,span.highlighted.green{color:var(--document-highlighter-green-background-text-color);background-color:var(--document-highlighter-green-background-color)}.document-wrapper mark.yellow,span.highlighted.yellow{color:var(--document-highlighter-yellow-background-text-color);background-color:var(--document-highlighter-yellow-background-color)}.document-wrapper mark.purple,span.highlighted.purple{color:var(--document-highlighter-purple-background-text-color);background-color:var(--document-highlighter-purple-background-color)}.document-wrapper u{text-decoration:underline;text-decoration-color:var(--document-accent-color);unicode-bidi:embed}.document-wrapper s,.document-wrapper strike{text-decoration:line-through}.document-wrapper a{color:var(--document-link-color);unicode-bidi:embed;cursor:pointer}.document-wrapper a:hover{text-decoration:inherit}.document-wrapper .wiki-separator-marker{display:inline;color:inherit}.document-wrapper .link-definition-title{color:var(--document-text-light-color)}.document-wrapper .footnote-ref{font-size:.9em;vertical-align:super}.document-wrapper span.entity{direction:ltr;unicode-bidi:embed;color:var(--document-code-syntax-highlight-entity)}.document-wrapper span.escape{unicode-bidi:embed}.document-wrapper .color{font-family:var(--document-code-font),monospace;font-size:var(--document-code-text-size-multiplier);padding-inline-start:1.2em;position:relative;direction:ltr;unicode-bidi:embed}.document-wrapper .color::before{content:"";position:absolute;width:.9em;height:.9em;left:0;bottom:0;transform:translateY(-15%);border:var(--document-hairline-width) solid rgb(0,0,0,.3);border-radius:.9em;background-color:var(--data-color)}.document-wrapper .hashtag{color:var(--document-tag-text-color);background-color:var(--document-tag-background-color);border-radius:1em;padding:calc(var(--document-inline-padding-top-bottom) - 2 * var(--document-hairline-width)) calc(var(--document-inline-padding-left-right) + .3em);unicode-bidi:embed}.document-wrapper .hashtag>.marker{display:inline;color:var(--document-tag-marker-color);padding:0}.document-wrapper table{display:block;max-width:fit-content;overflow-x:auto;border-collapse:separate;border-spacing:0;border:var(--document-hairline-width) solid var(--document-table-border-color);border-radius:.33em;margin-bottom:calc(var(--document-line-height-multiplier) * 1em)}.document-wrapper table[data-direction="2"]{margin-left:auto;direction:ltr}.document-wrapper tr{display:table-row;background-color:var(--document-table-cell-background-color)}.document-wrapper tr.header-row,.document-wrapper tr:nth-child(odd){background-color:var(--document-table-cell-alternate-background-color)}.document-wrapper td,.document-wrapper th{box-sizing:border-box;display:table-cell;padding:.37em .75em;min-width:5em;border-right:var(--document-hairline-width) solid var(--document-table-border-color)}.document-wrapper td:last-of-type,.document-wrapper th:last-of-type{border:none}.document-wrapper table[data-direction="2"] td{margin-left:auto}.document-wrapper td[data-alignment="2"]{text-align:right}.document-wrapper td[data-alignment="3"]{text-align:center}.document-wrapper .code_comment{color:var(--document-code-syntax-highlight-comment)}.document-wrapper .code_constant{color:var(--document-code-syntax-highlight-constant)}.document-wrapper .code_number{color:var(--document-code-syntax-highlight-number)}.document-wrapper .code_string{color:var(--document-code-syntax-highlight-string)}.document-wrapper .code_entity{color:var(--document-code-syntax-highlight-entity)}.document-wrapper .code_keyword{color:var(--document-code-syntax-highlight-keyword)}.document-wrapper .code_function{color:var(--document-code-syntax-highlight-function)}.document-wrapper .code_variable{color:var(--document-code-syntax-highlight-variable)}.document-wrapper img{max-width:100%}.document-wrapper .pdf_preview{display:inline-block;width:100%;height:500px;background-color:#fff;overflow:hidden;padding:0;margin:0;position:relative;border-radius:4px}.document-wrapper .arrow svg #body,.document-wrapper .arrow svg #head{fill:var(--base-text-color)}.document-wrapper .todo-checkbox svg #body{stroke:var(--document-task-border-color)}.document-wrapper .todo-checkbox svg #check{fill:var(--document-task-check-color)}.document-wrapper .todo-checkbox.todo-checked svg #body{opacity:.35}.document-wrapper .todo-checkbox.todo-checked svg #check{opacity:.4}

        </style>
    </head>
    <body>
        <div class="document-wrapper">
            <h1 id='Asynchronous Processing'>Asynchronous Processing</h1><br>
<h1 id='Table of Contents'>Table of Contents</h1><ul>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Core%20Concepts'>Core Concepts</a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Message%20Queue'>Message Queue</a>
<ul>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Message%20Producers%20'>Message Producers </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Message%20broker'>Message broker</a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Message%20Consumers%20'>Message Consumers </a></li>
</ul>
</li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Routing%20methods%20'>Routing methods </a>
<ul>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Direct%20Worker%20Queue%20Method'>Direct Worker Queue Method</a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Publish/Subscribe%20Method'>Publish/Subscribe Method</a></li>
</ul>
</li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Messaging%20Protocols%20'>Messaging Protocols </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Messaging%20Infrastructure%20'>Messaging Infrastructure </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Benefits%20of%20Message%20Queues'>Benefits of Message Queues</a>
<ul>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Enabling%20Asynchronous%20Processing%20'>Enabling Asynchronous Processing </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Evening%20Out%20Traffic%20Spikes%20'>Evening Out Traffic Spikes </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Decoupling%20and%20self%20healing'>Decoupling and self healing</a></li>
</ul>
</li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Message%20Queue%E2%80%93Related%20Challenges'>Message Queue–Related Challenges</a>
<ul>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=No%20Message%20Ordering%20'>No Message Ordering </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Message%20Re-queueing%20'>Message Re-queueing </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Risk%20of%20Increased%20Complexity%20'>Risk of Increased Complexity </a></li>
</ul>
</li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=%20Message%20Queue%E2%80%93Related%20Anti-Patterns'> Message Queue–Related Anti-Patterns</a>
<ul>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Treating%20the%20Message%20Queue%20as%20a%20TCP%20Socket%20'>Treating the Message Queue as a TCP Socket </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Treating%20Message%20Queue%20as%20a%20Database%20'>Treating Message Queue as a Database </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Coupling%20Message%20Producers%20with%20Consumers%20'>Coupling Message Producers with Consumers </a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Lack%20of%20Poison%20Message%20Handling%20'>Lack of Poison Message Handling </a></li>
</ul>
</li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Quick%20Comparison%20of%20Selected%20Messaging%20Platforms'>Quick Comparison of Selected Messaging Platforms</a></li>
<li><a href='bear://x-callback-url/open-note?id=E7297FB5-2E32-4F51-A8BC-7FAF90C933A7&header=Introduction%20to%20Event-Driven%20Architecture'>Introduction to Event-Driven Architecture</a></li>
</ul><br>
<hr><br>
<br>
<ul>
<li>Instead of telling the system what to do step by step
<ul>
<li>We break down the work into smaller pieces and let it decide the optimal execution order.</li>
</ul>
</li>
</ul><br>
<h2 id='Core Concepts'>Core Concepts</h2><ul>
<li><b>Synchronous processing</b>, the caller sends a request to get something done and <b>waits</b> for the response before continuing its own work</li>
<li><b>Asynchronous processing</b>, issuing requests that do not block your execution (<b>never waits</b>)
<ul>
<li>A <b>callback</b> is a construct of asynchronous processing where the caller does not block while waiting for the result of the operation, but provides a mechanism to be <b>notified</b> once the operation is finished.</li>
</ul>
</li>
</ul><p><img src='Asynchronous%20Processing/1087DDC0-3656-4AF0-A6CF-A982E9FC6C88.png'></p><br>
<h2 id='Message Queue'>Message Queue</h2><ul>
<li>A <b>message queue</b> is a component that buffers and distributes asynchronous requests.
<ul>
<li><b>Messages</b> (a piece of <b>XML</b> or <b>JSON</b> with all of the data that is needed to perform the requested operation) are created by message producers and then buffered by the <b>message queue</b></li>
<li>Finally, they are delivered to <b>message consumers</b> who perform the asynchronous action on behalf of the producer.</li>
</ul>
</li>
</ul><p><img src='Asynchronous%20Processing/70CEB9D2-B055-41DA-A06E-C9DD23F1DBDD.png'></p><ul>
<li><b>Advantage</b>
<ul>
<li>Nonblocking communication between producer and consumer</li>
<li>Separation means producers and consumers can be scaled separately and implemented in different stacks</li>
</ul>
</li>
</ul><br>
<h3 id='Message Producers'>Message Producers</h3><ul>
<li>Message producers are parts of the client code that <b>initiate</b> asynchronous processing
<ul>
<li>Create a valid message and send it to the message queue</li>
</ul>
</li>
</ul><br>
<h3 id='Message broker'>Message broker</h3><ul>
<li>A message broker is a specialized application designed for fast and flexible message <b>queuing</b>, <b>routing</b>, and <b>delivery</b></li>
</ul><br>
<h3 id='Message Consumers'>Message Consumers</h3><ul>
<li><b>Receive</b> and <b>process</b> messages from the message queue</li>
<li>A <b>cron-like consumer</b> connects periodically to the queue and checks</li>
</ul><br>
<p>the status of the queue.<br>
A <b>daemon-like consumer</b> runs constantly in an infinite loop, and it usually has a permanent connection to the message broker.</p><br>
<h2 id='Routing methods'>Routing methods</h2><h3 id='Direct Worker Queue Method'>Direct Worker Queue Method</h3><ul>
<li>Each message arriving to the queue is routed to only one consumer.</li>
</ul><p><img src='Asynchronous%20Processing/70FD15F2-BB40-40E1-8454-CB1CF48841BA.png'></p><br>
<h3 id='Publish/Subscribe Method'>Publish/Subscribe Method</h3><ul>
<li>Consumers using the publish/subscribe model have to connect to the message broker and declare which <b>topics</b> they are interested in.</li>
<li>Whenever a new message is published to a topic, it is <b>cloned</b> for each consumer subscribing to it.</li>
<li><b>A message could be processed by different services</b> (<b>Easy way to add more functionality</b>, <b>open-closed principle</b>)
<ul>
<li>E-commerce, When a purchase is completed <span class='arrow'><svg width="12px" height="12px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="Arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(0.000000, 0.500000)" fill="#444444">
            <rect id="body" x="0" y="4.5" width="10" height="2"></rect>
            <path d="M7,0 L11.7928932,4.79289322 C12.1834175,5.18341751 12.1834175,5.81658249 11.7928932,6.20710678 L7,11 L7,11 L6,10 L8.5,6 L8.5,5 L6,1 L7,0 Z" id="head"></path>
        </g>
    </g>
</svg></span> notifies shipping providers and processes loyalty program rules (two services)</li>
</ul>
</li>
</ul><p><img src='Asynchronous%20Processing/902272E6-AFAA-467D-9F75-492406FFC9FF.png'></p><br>
<h2 id='Messaging Protocols'>Messaging Protocols</h2><ul>
<li><b>AMQP (Advanced Message Queuing Protocol)</b></li>
<li><b>STOMP (Streaming Text-Oriented Messaging Protocol)</b>
<ul>
<li>Not standard, different implementation has different header</li>
</ul>
</li>
<li><b>JMS (Java Message Service)</b></li>
</ul><br>
<h2 id='Messaging Infrastructure'>Messaging Infrastructure</h2><ul>
<li>Queue worker machines should be <b>stateless</b> just like web application servers and web service machines.
<ul>
<li>Workers should get all of their data from the queue and external persistence stores.</li>
</ul>
</li>
</ul><p><img src='Asynchronous%20Processing/A0DFEF39-8653-41C1-9C53-A16C2F85C14D.png'></p><ul>
<li>No matter what messaging solution you use, do some research (get to know what works under the hood and avoid gotcha) (To scale horizontally, usually you need to do application-level sharding to push to different message brokers)
<ul>
<li><b>Number of messages published per second</b></li>
<li><b>Average message size</b></li>
<li><b>Number of messages consumed per second</b>
<ul>
<li>Can be much higher than publishing rate</li>
</ul>
</li>
<li><b>Number of concurrent publishers</b></li>
<li><b>Number of concurrent consumers</b></li>
<li><b>If message persistence is needed</b> (no message loss during message broker crash)</li>
<li><b>If message acknowledgment is needed</b> (no message loss during consumer crash)</li>
</ul>
</li>
</ul><br>
<h2 id='Benefits of Message Queues'>Benefits of Message Queues</h2><h3 id='Enabling Asynchronous Processing'>Enabling Asynchronous Processing</h3><ul>
<li><b>Interacting with remote servers</b></li>
<li><b>Low-value processing in the critical path</b> (non-critical feature)</li>
<li><b>Resource intensive work</b></li>
<li><b>Independent processing of high- and low-priority jobs</b></li>
</ul><br>
<h3 id='Evening Out Traffic Spikes'>Evening Out Traffic Spikes</h3><p><img src='Asynchronous%20Processing/0080D6D0-AC1D-4CA7-A589-74BB64A60A35.png'></p><br>
<h3 id='Decoupling and self healing'>Decoupling and self healing</h3><ul>
<li><b>Producers and consumers do not talk to each other</b>, they don’t know how the other does its job (don’t even know if the other exist)</li>
</ul><p><img src='Asynchronous%20Processing/C27930CB-A18B-4EFE-838D-D62C21B7A365.png'></p><br>
<ul>
<li>To <b>recover</b> from <b>failure</b>, you simply <b>add a server replacement</b> and the system “heals” itself automatically by <b>slowly catching up</b> with the queues and draining messages over time</li>
</ul><br>
<h2 id='Message Queue–Related Challenges'>Message Queue–Related Challenges</h2><h3 id='No Message Ordering'>No Message Ordering</h3><ul>
<li>When messages need to be processed in certain order but fail to do so due to parallel consumer processing speed or failure</li>
</ul><p><img src='Asynchronous%20Processing/12A76D02-DC35-45EA-A273-88340A4D3FCB.png'></p><br>
<h4 id='Solution'>Solution</h4><ul>
<li><b>Build the system to assume that messages can arrive in random order</b>
<ul>
<li>If the front end published a create-account message, then <b>consumer 1 could publish</b> an email-customer message once the account has been created.</li>
</ul>
</li>
<li><b>Use a messaging broker that supports partial message ordering guarantee</b> (ActiveMQ)</li>
<li><b>Explicit search for race conditions and out-of-order processing bugs</b>
<ul>
<li>The less you assume about the state of an asynchronous system, the better.</li>
</ul>
</li>
</ul><br>
<h3 id='Message Re-queueing'>Message Re-queueing</h3><ul>
<li>Messages can be <b>re-queued</b> in some failure scenarios</li>
<li>A strategy worth considering is to depend on <b>at-least-once</b> delivery instead of <b>exactly-once</b> delivery</li>
<li>An <b>idempotent consumer</b> is a consumer that can process the same message multiple times without affecting the final result
<ul>
<li>Setting the price to 55 is idempotent</li>
<li>Adding 5 to the price is <b>not</b> idempotent</li>
</ul>
</li>
<li><b>Idempotent consumers</b> may be more <b>sensitive</b> to messages being processed <b>out of order</b></li>
<li><b>Non-idempotent consumers</b> may be more <b>sensitive</b> to message <b>re-queueing (redelivery)</b>, but not to out-of-order delivery</li>
</ul><br>
<h3 id='Risk of Increased Complexity'>Risk of Increased Complexity</h3><ul>
<li><b>Abstraction (Decoupling) <span class='arrow'><svg width="12px" height="12px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="Arrow" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(0.000000, 0.500000)" fill="#444444">
            <rect id="body" x="0" y="4.5" width="10" height="2"></rect>
            <path d="M7,0 L11.7928932,4.79289322 C12.1834175,5.18341751 12.1834175,5.81658249 11.7928932,6.20710678 L7,11 L7,11 L6,10 L8.5,6 L8.5,5 L6,1 L7,0 Z" id="head"></path>
        </g>
    </g>
</svg></span> complexity (in understanding the dependency)</b></li>
<li><b>Without good documentation</b> of the message <b>routes</b> and <b>visibility</b> of how the messages flow through the system, you may <b>increase the complexity</b> and make it much harder for developers to understand how the system works</li>
</ul><br>
<h2 id='Message Queue–Related Anti-Patterns'>Message Queue–Related Anti-Patterns</h2><ul>
<li>A typical <b>anti-pattern</b> is a solution that seems like <b>a good idea at first</b>, but the longer you use it, the more issues you discover with it</li>
</ul><br>
<h3 id='Treating the Message Queue as a TCP Socket'>Treating the Message Queue as a TCP Socket</h3><ul>
<li>Some message brokers allow you to create <b>return channels</b></li>
<li>If you <b>use it a lot</b>, you may end up with an <b>application</b> that is <b>more synchronous</b></li>
<li>Response channels may also mean that <b>failures</b> of different components on different sides of the message broker may have an <b>impact on one another</b></li>
</ul><br>
<h3 id='Treating Message Queue as a Database'>Treating Message Queue as a Database</h3><ul>
<li>You should not allow <b>deleting</b> messages or <b>updating</b> them</li>
<li>Using random access to modify and delete messages may <b>prevent</b> you from <b>scaling out</b> and <b>migrating</b> to a different messaging broker</li>
</ul><br>
<h3 id='Coupling Message Producers with Consumers'>Coupling Message Producers with Consumers</h3><ul>
<li>If something is not declared explicitly in the message contract, it should be an <b>implementation detail</b></li>
<li>A <b>flawed implementation</b> involved <b>serializing an entire object</b> and adding it to the message body.
<ul>
<li>This meant that the consumer had to have this particular class available, and it was not able to process the message without executing the serialized object’s code</li>
<li>Even worse, the consumer needs to be in the same technology and be updated accordingly</li>
</ul>
</li>
</ul><br>
<h3 id='Lack of Poison Message Handling'>Lack of Poison Message Handling</h3><ul>
<li>When working with message queues you have to be able to <b>handle broken messages and bugs in consumer code</b>
<ul>
<li>You have to assume that components of your messaging platform will <b>crash</b>, go <b>offline</b>, <b>stall</b>, and <b>fail</b> in unexpected ways</li>
<li>You also have to assume that <b>messages</b> may be <b>corrupt</b> or even <b>malicious</b></li>
</ul>
</li>
<li>A <b>message of death</b> (poison message) is a message that <b>causes a consumer to crash</b> or fail in some unexpected way
<ul>
<li>It can <b>freeze</b> the entire message-processing pipeline (failed message are likely to be resend to other consumers)</li>
</ul>
</li>
<li>In <b>ActiveMQ</b> you can use <b>dead-letter queue policies</b> (message removed after a number of failures)</li>
<li>In <b>Amazon SQS</b>, you can implement poison message handling in your own code by using an <b>approximate delivery counter</b> (after certain number, the message is routed to your custom handler)</li>
</ul><br>
<h2 id='Quick Comparison of Selected Messaging Platforms'>Quick Comparison of Selected Messaging Platforms</h2><ul>
<li>Amazon Simple Queue Service</li>
<li>RabbitMQ</li>
<li>ActiveMQ with Camel (routing)</li>
</ul><br>
<h2 id='Introduction to Event-Driven Architecture'>Introduction to Event-Driven Architecture</h2><ul>
<li><b>Event-driven architecture (EDA)</b> is an <b>architecture</b> style where most interactions between different components are realized by <b>announcing events</b> that have already happened instead of requesting work to be done</li>
<li>An <b>event</b> is an <b>object</b> or a <b>message</b> that indicates something has happened.
<ul>
<li>An order in an online store has been placed, In such case, an event would probably contain information about the buyer and items purchased.</li>
</ul>
</li>
<li><b>Event sourcing</b>, You could use events to <b>re-create the state of the entire system</b> by simply <b>replaying events</b>
<ul>
<li><b>Event sourcing</b> is a technique where every change to the application state is persisted in the form of an event. Events are usually stored on disk in the form of event log files or some data store.</li>
<li><b>Difficult</b> in distributed system all over the world, trying to preserve <b>time</b> and <b>order</b></li>
</ul>
</li>
</ul><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<p><span class='hashtag'><span class='hashtag-marker marker'>#</span>_book<span class='hashtag-separator-marker marker'>/</span>Programing<span class='hashtag-separator-marker marker'>/</span>Web-Scalability</span></p>
        </div>
    </body>
</html>
